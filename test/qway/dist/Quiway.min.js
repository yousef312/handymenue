(function(f,a){"uses strict";"function"===typeof define&&define.amd?define([],build):"object"===typeof module&&module.exports?module.exports=a():f.Quiway=a()})(this,function(){void 0===[].findIndex&&(Array.prototype.findIndex=function(a){for(var b=-1,c=0;c<this.length;c++)if(out=a(this[c],c,this),!0===out){b=c;break}return b});var f=function(a){var b=this;this.shortcutslist=[];this.combo=[];this.holdingActions=[];this.duplicates=void 0===a?!1:a;this.KEYS="command ctrl shift alt altGraph capslock tab backspace enter meta space escape pageup pagedown home insert delete end arrowup arrowdown arrowleft arrowright 1 2 3 4 5 6 7 8 9 0 a b c d e f g h i j k l m n o p q r s t u v w x y z * f1 f2 f3 f4 f5 f6 f7 f8 f9 f10 f11".split(" ");
this.comboActivated=this.shortcutActivated=!0;this.intercativeMode=!1;this.toBuild=[[],[]];this.QEF=function(){};this.keysuite={};window.addEventListener("keydown",function(c){b.handleKeydown.call(b,c)});window.addEventListener("keyup",function(c){b.handleKeyup.call(b,c)});window.addEventListener("blur",function(){b.blur.call(b)})};f.prototype={approve:function(){if(0!==this.toBuild[0].length){var a=this.toBuild[0].join("+");this.bind(a,this.toBuild[1][1]);this.toBuild=[[],[]];return a}},approveToReplace:function(){if(0!==
this.toBuild[0].length){var a=this.toBuild[0],b=this.toBuild[1][1],c=this.shortcutslist.find(function(e){return e.callback.toString()===b.toString()}),d=-1!==this.check(a.join("+"));if(void 0!==c&&!d)return this.unbind(c.shortcut.join("+"),c.callback),c=this.bind(a.join("+"),this.toBuild[1][1]),this.toBuild=[[],[]],this.intercativeMode=!1,!1===c?c:a;this.toBuild=[[],[]];return this.intercativeMode=!1}},abort:function(){this.intercativeMode=!1;this.toBuild=[[],[]]},resetCombo:function(a,b){a=this.supervise(a).join(",");
var c=this.combo.findIndex(function(d){return d.combo.join(",")===a&&(void 0===b||void 0!==b&&d.callback.toString()===b.toString())});return-1!==c?(this.combo[c].progress="",this.combo[c].done=!1,!0):!1},toggleCombo:function(a,b,c){a=this.supervise(a).join(",");var d=this.combo.findIndex(function(e){return e.combo.join(",")===a&&(void 0===b||void 0!==b&&e.callback.toString()===b.toString())});return-1!==d?(this.combo[d].active="boolean"===typeof c?c:!this.combo[d].active,!0):!1},toggleShortcut:function(a,
b,c){a=this.supervise(a).join("+");var d=this.shortcutslist.findIndex(function(e){return e.shortcut.join("+")===a&&(void 0===b||void 0!==b&&b.toString()===e.callback.toString())});return-1!==d?(this.shortcutslist[d].active="boolean"===typeof c?c:!this.shortcutslist[d].active,!0):!1},replace:function(a,b){var c=this.shortcutslist.find(function(d){return void 0!==d.callback&&d.callback.toString()===a.toString()});return void 0!==c?(this.unbind(c.shortcut.join("+"),c.callback),this.bind(b,a)):!1},getFromUser:function(a,
b,c){this.intercativeMode=!0;this.toBuild[1].push(a,b,c)},stopGettingFromUser:function(){this.intercativeMode=!1;this.toBuild=[[],[]]},handleKeyup:function(a){var b=a.key.toLowerCase();b=" "===b?"space":b.trim();b="control"===b?"ctrl":b;this.keysuite[b]=!1;if(!1===this.intercativeMode){if(0!==this.shortcutslist.length){if(!1===this.shortcutActivated)return;this.shortcutslist.forEach(function(d){if(-1!==d.shortcut.indexOf(b))for(var e=d.shortcut.indexOf(b);e<d.shortcut.length;e++)d.progress[e]=!1});
0!==this.holdingActions.length&&this.holdingActions.forEach(function(d){d.key===b&&null!==d.timeout&&(clearTimeout(d.timeout),d.timeout=null)})}0!==this.combo.length&&!0===this.comboActivated&&this.combo.forEach(function(d,e){-1===d.combo.indexOf(b)||d.done||!0!==d.active||(a.preventDefault(),d.progress+=b,null!==d.timeout&&clearTimeout(d.timeout),d.progress===d.combo.join("")&&(d.done=!0),d.callback(d),d.done||(d.timeout=setTimeout(function(){d.progress="";d.callback(d)},d.timing)))})}else{var c=
this.toBuild[0].findIndex(function(d){return d===b});-1!==c&&(a.preventDefault(),this.toBuild[0].splice(c,1),this.toBuild[1][2](this.toBuild[0]))}},handleKeydown:function(a){var b=a.key.toLowerCase();b=" "===b?"space":b.trim();b="control"===b?"ctrl":b;this.keysuite[b]=!0;if(!1===this.intercativeMode){if(0!==this.shortcutslist.length&&!0===this.shortcutActivated&&this.shortcutslist.forEach(function(e){!1!==e.active&&("*"===e.shortcut[0]?(a.preventDefault(),e.progress[0]=!0):-1!==e.progress.indexOf(!0)&&
"*"==e.shortcut[e.progress.lastIndexOf(!0)+1]&&(a.preventDefault(),e.progress[e.progress.lastIndexOf(!0)+1]=!0),-1!==e.shortcut.indexOf(b)&&(a.preventDefault(),!0===e.progress[e.shortcut.indexOf(b)-1]||void 0===e.progress[e.shortcut.indexOf(b)-1])&&(e.progress[e.shortcut.indexOf(b)]=!0),!0===e.progress[e.progress.length-1]&&(a.preventDefault(),e.progress[e.progress.length-1]=!1,e.callback()))}),0!==this.holdingActions.length&&!0===this.shortcutActivated)for(var c=0;c<this.holdingActions.length;c++){var d=
this.holdingActions[c];b===d.key&&null===d.timeout&&(a.preventDefault(),this.holdingActions[c].timeout=setTimeout(d.callback,d.duration))}}else!0===this.intercativeMode&&-1===this.toBuild[0].findIndex(function(e){return e===b})&&(a.preventDefault(),this.toBuild[0].push(b),this.toBuild[1][2](this.toBuild[0]),this.toBuild[0].length===this.toBuild[1][0]&&(this.intercativeMode=!1,this.toBuild[1][2](this.toBuild[0],!0)))},bind:function(a,b,c){a=void 0===a?"ctrl+q":a;c=void 0===c?500:c;if("string"!==typeof a)console.warn("Quiway warn you:\nthe given shortcut not string!");
else{b="function"!==typeof b?this.QEF:b;c="number"!==typeof c?500:c;if(-1!==this.KEYS.indexOf(a)){if(b={shortcut:[a],progress:[!1],callback:b,active:!0},a=this.check(a),-1===a||this.duplicates)return this.shortcutslist.push(b),!0}else if(-1!==a.indexOf("+")){if(c=this.supervise(a),!1!==a&&(b={shortcut:c,progress:Array(c.length).fill(!1,0,c.length),callback:b,active:!0},a=this.check(c.join("+")),-1===a||this.duplicates))return this.shortcutslist.push(b),!0}else if(-1!==a.indexOf(",")){if(a=this.supervise(a),
!1!==a&&(b={progress:"",combo:a,done:!1,callback:b,timing:c,timeout:null,active:!0},a=this.check(a.join(",")),-1===a||this.duplicates))return this.combo.push(b),!0}else if(-1!==a.indexOf("=>")&&(c=this.supervise(a),!1!==a&&(b={key:c[0],duration:c[1],callback:b,timeout:null},a=this.check(a),-1===a||this.duplicates)))return this.holdingActions.push(b),!0;return!1}},unbind:function(a,b){if(void 0===a)this.shortcutslist=[],this.holdingActions=[],this.combo=[];else{var c=!1;if(-1!==this.KEYS.indexOf(a))for(var d=
this.shortcutslist.length-1;-1<d;d--){var e=this.shortcutslist[d];(void 0!==b&&e.callback.toString()===b.toString()||void 0===b)&&e.shortcut.join("")===a&&(this.shortcutslist.splice(d,1),c=!0)}else if(-1!==a.indexOf("+"))if("all"===b||void 0===b&&"+"===a)this.shortcutslist=[],c=!0;else for(a=this.supervise(a).join("+"),d=this.shortcutslist.length-1;-1<d;d--)e=this.shortcutslist[d],e.shortcut.join("+")===a&&(void 0!==b&&e.callback.toString()===b.toString()||void 0===b)&&(this.shortcutslist.splice(d,
1),c=!0);else if(-1!==a.indexOf(","))if("all"===b||void 0===b&&","===a)this.combo=[],c=!0;else for(a=this.supervise(a).join(","),d=this.combo.length-1;-1<d;d--)e=this.combo[d],e.combo.join(",")===a&&(void 0!==b&&e.callback.toString()===b.toString()||void 0===b)&&(this.combo.splice(d,1),c=!0);else if(-1!==a.indexOf("=>"))if("all"===b||void 0===b&&"=>"===a)this.holdingActions=[],c=!0;else for(a=this.supervise(a),d=this.holdingActions.length-1;-1<d;d--)e=this.holdingActions[d],e.key===a[0]&&e.duration===
a[1]&&(void 0!==b&&e.callback.toString()===b.toString()||void 0===b)&&(this.holdingActions.splice(d,1),c=!0);return c}},check:function(a){return-1!==a.indexOf("+")?this.shortcutslist.findIndex(function(b){return void 0!==b&&b.shortcut.join("+")===a}):-1!==a.indexOf(",")?this.combo.findIndex(function(b){return void 0!==b&&b.combo.join(",")===a}):-1!==a.indexOf("=>")?this.holdingActions.findIndex(function(b){return void 0!==b&&b.key===a}):this.shortcutslist.findIndex(function(b){return void 0!==b&&
b.shortcut[0]===a})},supervise:function(a){if(-1!==a.indexOf(",")&&(-1!==a.indexOf("+")||-1!==a.indexOf("=>"))||-1!==a.indexOf("+")&&(-1!==a.indexOf(",")||-1!==a.indexOf("=>"))||-1!==a.indexOf("=>")&&(-1!==a.indexOf("+")||-1!==a.indexOf(",")))return!1;var b=!1;if(-1!==a.indexOf("+")){a=a.split("+");for(var c=0;c<a.length;c++)if("control"===a[c]&&(a[c]="ctrl")," "===a[c]&&(a[c]="space"),a[c]=a[c].toLowerCase(),-1===this.KEYS.indexOf(a[c])){b=!0;break}return b?!1:a}if(-1!==a.indexOf(",")){a=a.split(",");
c=[];for(var d=0;d<a.length;d++){var e=" "===a[d]?"space":a[d].trim().toLowerCase();e="control"===e?"ctrl":e;if(-1!==e.indexOf("*")){e=e.split("*");times=parseFloat(e[1]);name=e[0].trim();if(-1===this.KEYS.indexOf(name)){b=!0;break}for(e=0;e<times;e++)c.push(name)}else if(c.push(e),-1===this.KEYS.indexOf(e)){b=!0;break}}return b?!1:c}if(-1!==a.indexOf("=>"))return a=a.split("=>"),b=parseFloat(a[1]),e=a[0],e=" "===e?"space":e.trim().toLowerCase(),e="control"===e?"ctrl":e,-1===this.KEYS.indexOf(e)?
!1:-1===this.KEYS.indexOf(e)?!1:[e,b];a=" "===a?"space":a.trim().toLowerCase();a="control"===a?"ctrl":a;return-1===this.KEYS.indexOf(a)?!1:{shortcut:a,callback:null}},pack:function(){return{duplicates:this.duplicates,shortcut:this.shortcutslist,holdingActions:this.holdingActions,shortcutActivated:this.shortcutActivated,comboActivated:this.comboActivated,combo:this.combo}},initiate:function(a){this.duplicates=a.duplicates||!1;this.shortcutslist=a.shortcut||[];this.combo=a.combo||[];this.holdingActions=
a.holdingActions||[];this.comboActivated=a.comboActivated||!0;this.shortcutActivated=a.shortcutActivated||!0},blur:function(){for(var a=0;a<this.shortcutslist.length;a++)this.shortcutslist[a].progress.fill(!1,0,this.shortcutslist[a].progress.length);for(a=0;a<this.combo.length;a++)this.combo[a].progress="";for(a=0;a<this.holdingActions.length;a++)null!==this.holdingActions[a].timeout&&(clearTimeout(this.holdingActions[a].timeout),this.holdingActions[a].timeout=null);this.intercativeMode=!1;this.toBuild=
[[],[]]}};return f});
