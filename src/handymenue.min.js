import Qway from"./qway/dist/qway.esm.js";import eye from"./eyeejs/src/eye.js";const hmNoop=()=>{};let keys=new Qway,namelssCounter=0;function HandyMenue(e){this.def=e,this.props={},this.on=!1,this.elm=null,this.target=window,this.radios={},this.submenus=[],this.computed={menuHeight:0,menuWidth:0,parent:null},this.untouchable=null}function handy(e,t){if(!e)throw new Error("Menu definiton must be provided!");let n=new HandyMenue(e);return n.init(t),n}HandyMenue.prototype={init:function(e){e||(e={});let{target:t=window,action:n="contextmenu",bars:i=5,spacing:s=30,parent:o=null,stickto:l=null}=e,a=this;this.target=t??window,this.computed.parent=o,this.props={target:t,action:n,bars:i,spacing:s,stickto:l},o?this.untouchable=o.untouchable:(this.untouchable=eye("div",{class:"handy-untouchable",parent:document.body}),this.untouchable.mousedown((function(){a.close()}))),this.create(),this.bindEvents(),this.compute()},bindEvents:function(){let e=(this.props.action??"contextmenu").split(" "),t=this;e.forEach((e=>{t.target.addEventListener(e,(function(e){e.preventDefault(),t.popup({x:e.clientX,y:e.clientY})}))}))},create:function(){let e=eye("div",{class:["handy-menu","unselect"],parent:document.body}),t=this;this.elm=e;let n=0,i=0;"number"==typeof this.props.bars?n=i=this.props.bars:Array.isArray(this.props.bars)&&(n=this.props.bars[0],i=this.props.bars[1]),e.css("padding-top",n+"px"),e.css("padding-bottom",i+"px"),this.elm.css("display","none"),this.def.forEach((e=>{t.addButton(e)}))},addButton:function(e){let t=e.type=e.type??"button",n=e.label=e.label??"",i=e.func=e.func??hmNoop,s=e.accelerator=e.accelerator??"",o=e.name=e.name??"",l=e.default=e.default??null,a=e.submenu=e.submenu??null,r=e.range=e.range??[0,100],d=e.step=e.step??1,c=e.format=e.format??"_value_",u=e.icon=e.icon??null,h=e.disabled=e.disabled??!1,p=e.def=e.def??"",f=this,m=this.props.spacing,y=this.props.wheel??!0,b=null,w=null,v=null,g=null,x=eye("div",{class:"handy-menu-item",parent:this.elm});if(x.refer("definition",e),s&&keys.bind(s,(function(){x.click()})),"separator"===t)x.class("+separator"),x.text(n);else{let k=Array.isArray(m)?m[0]:m,H=Array.isArray(m)?m[1]:m;b=eye("div",{parent:x},{width:`${k}px`,backgroundImage:u?`url(${u})`:""}),w=eye("div",{parent:x}),v=eye("div",{parent:x},{width:`${H}px`});let E=eye("div",{parent:w,text:n}),B=eye("div",{parent:w,text:s}),M=null;if("submenu"===t&&(B.class("+handy-menu-item-arrow"),M=handy(a,{action:"none",parent:this,stickto:x}),this.submenus.push(M),x.mouseleave((function(){this.tm&&clearTimeout(this.tm)}))),x.mouseenter((function(){for(let e=0;e<f.submenus.length;e++)f.submenus[e].close();"submenu"===t&&(this.tm=setTimeout((function(){let e=v.getBoundingClientRect();M.popup({x:e.left+e.width-3,y:e.top})}),500))})),"check-box"===t&&(n=Array.isArray(n)?n:[n,n],E.text(n[0]),g=eye("div",{class:"handy-check-box-mark"})),"radio-button"===t){if(!o)throw new Error("HandyeMenue Error:\n Radio boxes buttons definition must contain name attribute!");this.radios[o]||(this.radios[o]={ball:eye("div",{class:"handy-radio-button-mark"})},b.append(this.radios[o].ball)),!0===l&&b.append(this.radios[o].ball)}if("definition"===t){let e=eye("div",{class:"handy-definition-box",parent:document.body,html:p},{display:"none"});B.text("definition"),x.mouseenter((function(){let t=this.getBoundingClientRect(),n=t.left+t.width+5,i=t.top;window.innerWidth-(t.left+t.width)<200&&(n=t.left-205),e.css("left",`${n}px`).css("top",`${i}px`).css("display","inline-block")})),x.mouseleave((function(){e.css("display","none")}))}if(!0===h&&(x.css("background-color","transparent"),x.css("color","gray"),x.css("pointer-action","none"),x.css("cursor","default")),"slider"===t){x.class("+handy-slider"),B.class("+handy-slider-btns");let t=eye("div",{class:"handy-slider-btn",parent:B}),n=eye("div",{class:"handy-slider-show",parent:B}),s=eye("div",{class:"handy-slider-btn",parent:B});eye("div",{class:"handy-minus",parent:t}),eye("div",{class:"handy-plus1",parent:s}),eye("div",{class:"handy-plus2",parent:s});n.refer("value",l||r[0]),n.text(c.replace("_value_",n.refer("value"))),t.click((function(){n.refer("value",Math.max(n.refer("value")-d,r[0])),n.text(c.replace("_value_",n.refer("value"))),i(n.refer("value"),e,x)})),s.click((function(){n.refer("value",Math.min(n.refer("value")+d,r[1])),n.text(c.replace("_value_",n.refer("value"))),i(n.refer("value"),e,x)})),!0===y&&x.on("wheel",(function(e){e.preventDefault(),e.deltaY>=0?t.click():s.click()}))}}"submenu"===t||x.click((function(t){let s=!0,{type:l,disabled:a}=this.refer("definition");if(!0!==a&&-1==["slider","separator"].indexOf(l)){if("button"==l)s=i(x,e,t);else if("check-box"==l)!0===this.selected?(this.selected=!1,g.remove(),w.child(0).text(n[0])):(this.selected=!0,b.append(g),w.child(0).text(n[1])),s=i(this.selected,x,e);else if("radio-button"==l){let t=f.radios[o];t.ball&&b.append(t.ball),s=i(n,x,e)}!1!==s&&f.close(!0)}}))},popup:function(e){let{x:t,y:n}=e,i=this.props.stickto;if(null!=i&&(i instanceof HTMLElement||i.elm instanceof HTMLElement)){let{pos:e="after",closerBy:s=2}=i,o=(i instanceof HTMLElement?i:i.elm).getBoundingClientRect();"after"===e&&o.left+o.width+this.computed.menuWidth>window.innerWidth&&(e="before"),"after"===e?(t=o.left+o.width+2-s,n=o.top):"before"===e?(t=o.left-this.computed.menuWidth-2+s,n=o.top):"under"==e&&(t=o.left,n=o.top)}else n+this.computed.menuHeight>window.innerHeight-20&&(n=window.innerHeight-(20+this.computed.menuHeight)),t+this.computed.menuWidth>window.innerWidth-20&&(t=window.innerWidth-(20+this.computed.menuWidth));this.elm.css("left",t+"px"),this.elm.css("top",n+"px"),this.elm.css("position","fixed"),this.elm.css("display","inline-block"),this.untouchable.show("inline-block")},close:function(e){if(e&&this.computed.parent)return this.computed.parent.close(!0);0!=this.submenus.length&&this.submenus.forEach((e=>e.close())),this.elm.css("display","none"),this.computed.parent||this.untouchable.hide()},compute:function(){this.elm.css("left",-9999),this.elm.css("position","fixed"),this.elm.css("display","inline-block");let e=this.elm.getBoundingClientRect();this.computed.menuHeight=e.height,this.computed.menuWidth=e.width,this.elm.css("display","none")},hideButton:function(e){this.elm.child(e)&&this.elm.child(e).hide()},showButton:function(e){this.elm.child(e)&&this.elm.child(e).show()},toggleButton:function(e,t){if(this.elm.child(e)){let n=this.elm.child(e);"boolean"!=typeof t&&(t=!(1==n.refer("definition").disabled)),!0===t?(n.refer("definition").disabled=!0,n.css("background-color","transparent"),n.css("color","gray"),n.css("pointer-action","none"),n.css("cursor","default")):(n.refer("definition").disabled=!1,n.removeAttribute("style"))}}},console.warn("Don't forget to link the css file bundled with the library to get full functional menus!");export default handy;