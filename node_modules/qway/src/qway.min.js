const noop=()=>{},keyMap={a:["KeyA","KeyA","a"],b:["KeyB","KeyB","b"],c:["KeyC","KeyC","c"],d:["KeyD","KeyD","d"],e:["KeyE","KeyE","e"],f:["KeyF","KeyF","f"],g:["KeyG","KeyG","g"],h:["KeyH","KeyH","h"],i:["KeyI","KeyI","i"],j:["KeyJ","KeyJ","j"],k:["KeyK","KeyK","k"],l:["KeyL","KeyL","l"],m:["KeyM","KeyM","m"],n:["KeyN","KeyN","n"],o:["KeyO","KeyO","o"],p:["KeyP","KeyP","p"],q:["KeyQ","KeyQ","q"],r:["KeyR","KeyR","r"],s:["KeyS","KeyS","s"],t:["KeyT","KeyT","t"],u:["KeyU","KeyU","u"],v:["KeyV","KeyV","v"],w:["KeyW","KeyW","w"],x:["KeyX","KeyX","x"],y:["KeyY","KeyY","y"],z:["KeyZ","KeyZ","z"],0:["Digit0","Digit0","0"],1:["Digit1","Digit1","1"],2:["Digit2","Digit2","2"],3:["Digit3","Digit3","3"],4:["Digit4","Digit4","4"],5:["Digit5","Digit5","5"],6:["Digit6","Digit6","6"],7:["Digit7","Digit7","7"],8:["Digit8","Digit8","8"],9:["Digit9","Digit9","9"],"-":["Minus","Minus","-"],"=":["Equal","Equal","="],"[":["BracketLeft","BracketLeft","["],"]":["BracketRight","BracketRight","]"],"\\":["Backslash","Backslash","\\"],";":["Semicolon","Semicolon",";"],"'":["Quote","Quote","'"],"`":["Backquote","Backquote","`"],",":["Comma","Comma",","],".":["Period","Period","."],"/":["Slash","Slash","/"],space:["Space","Space","space"],enter:["Enter","Enter","enter"],backspace:["Backspace","Backspace","backspace"],tab:["Tab","Tab","tab"],capslock:["CapsLock","CapsLock","capslock"],escape:["Escape","Escape","escape"],insert:["Insert","Insert","insert"],delete:["Delete","Delete","delete"],home:["Home","Home","home"],end:["End","End","end"],pageup:["PageUp","PageUp","pageup"],pagedown:["PageDown","PageDown","pagedown"],contextmenu:["ContextMenu","ContextMenu","contextmenu"],arrowup:["ArrowUp","ArrowUp","arrowup"],arrowdown:["ArrowDown","ArrowDown","arrowdown"],arrowleft:["ArrowLeft","ArrowLeft","arrowleft"],arrowright:["ArrowRight","ArrowRight","arrowright"],shift:["Shift",["ShiftLeft","ShiftRight"],"shift"],control:["Control",["ControlLeft","ControlRight","MetaLeft","MetaRight"],"ctrl"],ctrl:["Control",["ControlLeft","ControlRight","MetaLeft","MetaRight"],"ctrl"],command:["Control",["ControlLeft","ControlRight","MetaLeft","MetaRight"],"command"],alt:["Alt",["AltLeft","AltRight"],"alt"],meta:["Meta",["MetaLeft","MetaRight"],"meta"],f1:["F1","F1","f1"],f2:["F2","F2","f2"],f3:["F3","F3","f3"],f4:["F4","F4","f4"],f5:["F5","F5","f5"],f6:["F6","F6","f6"],f7:["F7","F7","f7"],f8:["F8","F8","f8"],f9:["F9","F9","f9"],f10:["F10","F10","f10"],f11:["F11","F11","f11"],f12:["F12","F12","f12"],numlock:["NumLock","NumLock","numlock"],numpad0:["Numpad0","Numpad0","numpad0"],numpad1:["Numpad1","Numpad1","numpad1"],numpad2:["Numpad2","Numpad2","numpad2"],numpad3:["Numpad3","Numpad3","numpad3"],numpad4:["Numpad4","Numpad4","numpad4"],numpad5:["Numpad5","Numpad5","numpad5"],numpad6:["Numpad6","Numpad6","numpad6"],numpad7:["Numpad7","Numpad7","numpad7"],numpad8:["Numpad8","Numpad8","numpad8"],numpad9:["Numpad9","Numpad9","numpad9"],numpaddecimal:["NumpadDecimal","NumpadDecimal","numpaddecimal"],numpaddivide:["NumpadDivide","NumpadDivide","numpaddivide"],numpadmultiply:["NumpadMultiply","NumpadMultiply","numpadmultiply"],numpadsubtract:["NumpadSubtract","NumpadSubtract","numpadsubtract"],numpadadd:["NumpadAdd","NumpadAdd","numpadadd"],numpadenter:["NumpadEnter","NumpadEnter","numpadenter"],printscreen:["PrintScreen","PrintScreen","printscreen"],scrolllock:["ScrollLock","ScrollLock","scrolllock"],pause:["Pause","Pause","pause"],browserback:["BrowserBack","BrowserBack","browserback"],browserforward:["BrowserForward","BrowserForward","browserforward"],browserrefresh:["BrowserRefresh","BrowserRefresh","browserrefresh"],browserstop:["BrowserStop","BrowserStop","browserstop"],browsersearch:["BrowserSearch","BrowserSearch","browsersearch"],browserfavorites:["BrowserFavorites","BrowserFavorites","browserfavorites"],browserhome:["BrowserHome","BrowserHome","browserhome"],volumemute:["VolumeMute","VolumeMute","volumemute"],volumedown:["VolumeDown","VolumeDown","volumedown"],volumeup:["VolumeUp","VolumeUp","volumeup"],mediatracknext:["MediaTrackNext","MediaTrackNext","mediatracknext"],mediatrackprevious:["MediaTrackPrevious","MediaTrackPrevious","mediatrackprevious"],mediaplaypause:["MediaPlayPause","MediaPlayPause","mediaplaypause"],launchmail:["LaunchMail","LaunchMail","launchmail"],launchapp1:["LaunchApp1","LaunchApp1","launchapp1"],launchapp2:["LaunchApp2","LaunchApp2","launchapp2"],eject:["Eject","Eject","eject"],intlbackslash:["IntlBackslash","IntlBackslash","intlbackslash"],intlro:["IntlRo","IntlRo","intlro"],intlyen:["IntlYen","IntlYen","intlyen"],intlhash:["IntlHash","IntlHash","intlhash"],conversion:["Conversion","Conversion","conversion"],nonconversion:["NonConversion","NonConversion","nonconversion"],again:["Again","Again","again"],copy:["Copy","Copy","copy"],cut:["Cut","Cut","cut"],paste:["Paste","Paste","paste"],find:["Find","Find","find"],props:["Props","Props","props"],select:["Select","Select","select"],undo:["Undo","Undo","undo"],redo:["Redo","Redo","redo"],help:["Help","Help","help"],stop:["Stop","Stop","stop"],sleep:["Sleep","Sleep","sleep"],wakeup:["WakeUp","WakeUp","wakeup"],hiragana:["Hiragana","Hiragana","hiragana"],katakana:["Katakana","Katakana","katakana"],accept:["Accept","Accept","accept"],modechange:["ModeChange","ModeChange","modechange"]},isMacOS="macOS"===navigator.userAgentData?.platform||navigator.platform?.toUpperCase().includes("MAC"),isModifier=e=>["ctrl","control","command","shift","alt","meta"].includes(e),isNavSysKey=e=>["tab","enter","backspace","escape","delete","insert","capslock","printscreen","pause"].includes(e),isElectron=()=>"undefined"!=typeof process&&"object"==typeof process.versions&&!!process.versions.electron,isSensitiveKey=e=>!("undefined"!=typeof process&&"object"==typeof process.versions&&process.versions.electron)&&["f1","f5","f11","f12"].includes(e),translateKey=e=>keyMap.hasOwnProperty(e)?keyMap[e][1]:null,translateCombo=e=>/^[a-z0-9]$/i.test(e)||["arrowleft","arrowright","arrowup","arrowdown","*"].includes(e)?e.toLowerCase():null,mergeUnique=e=>[...new Set(e)],types=[{test:e=>e.includes(" ")||e.includes("+")&&e.includes(","),name:"bad"},{is:e=>e.includes("+"),validate:e=>{let t=e.toLowerCase().split("+");if(t.find((e=>!keyMap.hasOwnProperty(e))))return"unknown-keys";if(t.find((e=>["tab","enter","backspace","escape","delete","insert","capslock","printscreen","pause"].includes(e))))return"using-system-keys";let i=!1;return t.forEach(((e,t)=>{if(["ctrl","control","command","shift","alt","meta"].includes(e)){if(1==i)return}else i=!0})),i?"modifiers-misplacement":!t.find((e=>{return t=e,!("undefined"!=typeof process&&"object"==typeof process.versions&&process.versions.electron)&&["f1","f5","f11","f12"].includes(t);var t}))||"sensitive-keys"},parse:e=>e.split("+"),name:"shortcut"},{is:e=>e.includes(","),validate:()=>!0,parse:e=>e.split(","),name:"combo"},{is:e=>e.includes("=>"),validate:e=>{e.toLowerCase().split("=>");return!0},parse:e=>e.split("=>"),name:"timed"}];class BindingEvent extends CustomEvent{constructor(e,t={}){if(!["progress","finish"].includes(e))throw new Error(`[QwayJS] Unknown event type "${e}"`);super(e,{detail:t.detail||null,bubbles:t.bubbles??!1,cancelable:t.cancelable??!1,composed:t.composed??!1}),this.binding=t?.binding??null,this.qway=t?.qway??null}}class QBuildEvent extends CustomEvent{constructor(e,t={}){if(!["change","finish","abort","approved"].includes(e))throw new Error(`[QwayJS] Unknown event type "${e}"`);super(e,{detail:t.detail||null,bubbles:t.bubbles??!1,cancelable:t.cancelable??!1,composed:t.composed??!1}),this.builder=t?.builder??null,this.qway=t?.qway,this.progress=[t?.current,t?.len]}}class Binding{#e="";constructor(e,t,i,s){this.q=e,this.content=t,this.callback=i,this.options=s||{},this.progress=new Set,this.#e=s.type,this.events={},this.onprogress=noop,this.onfinish=noop,this.sequence=[]}get type(){return this.#e}get length(){return this.sequence&&this.sequence.length?this.sequence.length:1}onEvent(e,t){switch(e){case"keyup":this.keyUp(t);break;case"keydown":let e=this.keyDown(t);this.onprogress(this),e&&this.onfinish(this)}}reset(){}}class ShortcutBinding extends Binding{#t=new Set;constructor(e,t,i,s){const n=t.toLowerCase().split("+").map(translateKey);if(n.includes(null))throw new Error(`[QwayJS] Incorrect shortcut format "${short}"`);(s=s||{}).type="shortcut",super(e,t,i,s),this.sequence=n}keyUp(e){const t=e.code;this.#t.delete(t)}keyDown(e){const t=e.code,i=this;this.#t.add(t);const s=Array.from(this.#t),n=i.sequence.every(((e,t)=>Array.isArray(e)?e.includes(s[t]):s[t]===e));if(n)return e.preventDefault(),i.callback(),!0}reset(){this.#t.clear()}}class ComboBinding extends Binding{constructor(e,t,i,s){const n=(t=t.toLowerCase()).split(" ").map(translateCombo);if(n.includes(null))throw new Error(`[QwayJS] Incorrect combo string format "${t}"`);(s=s||{delay:300}).type="combo",super(e,t,i,s),this.sequence=n,this.timeout=null,this.progress=[]}keyUp(e){}keyDown(e){let t=this;this.progress.push(e.key.toLowerCase()),this.timeout&&this.q.getTimeoutFunc().clearTimeout(this.timeout);const i=this.sequence.every(((e,t)=>"*"===e||(Array.isArray(e)?e.includes(this.progress[t]):this.progress[t]===e)));if(this.timeout=this.q.getTimeoutFunc().setTimeout((function(){t.progress=[]}),this.options?.delay||300),i)return e.preventDefault(),this.callback(),!0}reset(){this.timeout&&this.q.getTimeoutFunc().clearTimeout(this.timeout),this.progress=[]}}class TimedKey extends Binding{#i=null;constructor(e,t,i,s){t=t.toLowerCase();const[n,r]=t.split("=>");let a=translateKey(n);if(null===a)throw new Error(`[QwayJS] Incorrect timedkey "${t}"`);(s=s||{delay:300}).type="timed",super(e,t,i,s),this.sequence=[a],this.dur=parseFloat(r||"1000")}keyUp(e){!0!==this.options?.fragile&&this.sequence[0]!==e.code||(this.q.getTimeoutFunc().clearTimeout(this.timeout),this.timeout=null)}keyDown(e){let t=this;this.sequence[0]!==e.code||this.timeout?!0===this.options?.fragile&&(this.q.getTimeoutFunc().clearTimeout(this.timeout),this.timeout=null):(this.progress.add(e.code),e.preventDefault(),this.timeout=this.q.getTimeoutFunc().setTimeout((function(){t.callback(),t.timeout=null}),this.dur))}reset(){this.timeout&&this.q.getTimeoutFunc().clearTimeout(this.timeout)}}class QBuilder{#t=new Set;constructor(e){this.q=e,this.on=!1,this.cb=null,this.len=0}start(e,t){if("number"!=typeof e||0===e||"function"!=typeof t)throw new Error(`[QwayJS] TypeError: len must be number received "${typeof e}", cb must be function recieved "${typeof t}"`);this.#t.clear(),this.on=!0,this.cb=t,this.len=e}end(){this.#t.clear(),this.on=!1}receive(e,t){if(!("keydown"==e&&this.#t.size>=this.len)){switch(e){case"keydown":this.#t.add(t.code);break;case"keyup":this.#t.delete(t.code)}this.q.trigger("builder-change",this,new QBuildEvent("change",{builder:this,current:this.#t.size,len:this.len,qway:this.q})),this.#t.size==this.len&&this.q.trigger("builder-finish",this,new QBuildEvent("finish",{builder:this,current:this.#t.size,len:this.len,qway:this.q}))}}approve(){this.q.bind(this.getString("+"),this.cb),this.q.trigger("builder-approved",this,new QBuildEvent("approved",{builder:this,qway:this.q})),this.end()}abort(){this.on&&(this.q.trigger("builder-abort",this,new QBuildEvent("abort",{builder:this,qway:this.q})),this.end())}getString(e){let t=[],i=Object.values(keyMap);return Array.from(this.#t).forEach((e=>{t.push(i.find((t=>Array.isArray(t[1])?t[1].includes(e):t[1]===e))[2])})),"string"==typeof e?t.join(e):t}}class QwayClass{#s=[];#n={};#r={};#a=!0;#o=!0;#c=!0;#u=!0;#d=!0;#l=[setTimeout.bind(window),clearTimeout.bind(window)];constructor(){this.builder=new QBuilder(this),this.#p()}#p(){let e=this;window.addEventListener("keydown",(function(t){e.builder.on&&e.builder.receive("keydown",t),e.#a&&!["INPUT","TEXTAREA"].includes(this.document.activeElement.tagName)&&(e.#s.forEach((i=>{("combo"==i.type&&e.#c||"shortcut"==i.type&&e.#o||"timed"==i.type&&e.#u)&&i.onEvent("keydown",t)})),e.#n[t.code]=!0)})),window.addEventListener("keyup",(function(t){e.builder.on&&e.builder.receive("keyup",t),e.#a&&!["INPUT","TEXTAREA"].includes(this.document.activeElement.tagName)&&(e.#s.forEach((e=>{e.onEvent("keyup",t)})),e.#n[t.code]=!1)})),window.addEventListener("blur",(function(){e.#s.forEach((e=>{e.reset()})),e.declineFromUser()}))}bind(e,t){let i=this;if(this.reserved(e))return!1;let s=[];if(keyMap.hasOwnProperty(e)||e.includes("+")||Array.isArray(e)?(Array.isArray(e)?e:[e]).forEach((e=>{s.push(new ShortcutBinding(this,e,t))})):e.includes(" ")?s.push(new ComboBinding(this,e,t)):e.includes("=>")&&s.push(new TimedKey(this,e,t)),s.includes(null))throw new Error("[QwayJS] Could not bind the new shortcut!");return s.forEach((e=>{e.onprogress=function(e){i.trigger("progress",e,new BindingEvent("progress",{binding:e,qway:i}))},e.onfinish=function(e){i.trigger("finish",e,new BindingEvent("finish",{binding:e,qway:i}))},i.#s.push(e)})),!0}unbind(e,t){let i=this.#s.findIndex((i=>i.content==e&&i.callback===t));return-1!=i&&(this.#s.splice(i,1),!0)}replace(e,t){let i=this.#s.find((t=>t.callback===e));i&&(this.unbind(i.content,i.callback),this.bind(t,e))}on(e,t){if("function"!=typeof t)throw new Error(`[QwayJS] .on accepts a function as callback a "${typeof t}" is passed!`);return this.#r[e]||(this.#r[e]=[]),this.#r[e].push(t),this}off(e,t){if("function"!=typeof t)throw new Error(`[QwayJS] .on accepts a function as callback a "${typeof t}" is passed!`);if(!this.#r[e])return;let i=this.#r[e].findIndex((e=>e===t));return-1!=i&&(this.#r.splice(i,1),!0)}trigger(e,t,...i){this.#r[e]&&this.#r[e].forEach((e=>e.call(t,...i)))}isKeyPressed(e){if(e=" "===e?"space":e.toLowerCase(),keyMap[e])return this.#n[keyMap[e][1]]||!1}getFromUser(e,t){return this.#d=this.#a,this.#a=!1,this.builder.start(e,t),this}approveFromUser(e){if(!0===e){let e=this.attached(this.builder.cb);e&&this.unbind(this.#s[e].content,this.#s[e].callback)}this.builder.approve(),this.#a=this.#d}declineFromUser(){this.builder.abort(),this.#a=this.#d}activate(e){switch(e){case"combo":this.#c=!0;break;case"shortcut":this.#o=!0;break;case"timed":this.#u=!0;break;default:this.#a=!0}this.#d=!0}disactivate(e){switch(e){case"combo":this.#c=!1;break;case"shortcut":this.#o=!1;break;case"timed":this.#u=!1;break;default:this.#a=!1}this.#d=!1,this.#s.forEach((t=>{e&&t.type!==e||t.reset()}))}reserved(e){return-1!=this.#s.findIndex((t=>t.content===e))}attached(e){return-1!=this.#s.findIndex((t=>t.callback===e))}find(e,t){let i=this,s=this.#s.findIndex((i=>i.content===e&&i.callback===t));return{index:s,get:()=>-1!=s?JSON.parse(JSON.stringify(i.#s[s])):null,unbind:()=>-1!=s?i.unbind(e,t):null}}defineTimeoutFunc(e,t){if("function"!=typeof e||"function"!=typeof t)throw new Error("[QwayJS] both function arguments are required when defining your custom timeout system!");this.#l[0]=e,this.#l[1]=t}getTimeoutFunc(){return{setTimeout:this.#l[0],clearTimeout:this.#l[1]}}}let qway=new QwayClass;export default qway;